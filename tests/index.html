<!DOCTYPE html>
<html>
    <head>
        <title>Google Calendar API Quickstart</title>
        <meta charset="utf-8" />
        <script src="https://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js"></script>
        <script src="./jws-3.2.min.js"></script>
    </head>
    <body>
        <p>Google Calendar API Quickstart</p>

        <!--Add buttons to initiate auth sequence and sign out-->
        <button onclick="get_settings()">get</button>
        <button onclick="createCalendar()">create</button>
        <button onclick="get_calendars()">cet calendars</button>
        <button onclick="get_events()">get eventz</button>
        <button onclick="delete_calendar()">del cal</button>
        <button onclick="get_token()">get token</button>
        <code type="text/json" id="code">

        </code>

        <script type="text/javascript">

            function get_token() {
                let privKey = "\"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDX5Eflqh7LJgWH\\n+vJOIzVMFI9tA/RWi68yRQ4hQQbHwyfIqLER9W7CLd8HcjOKRQDAi0wlfjDMFpIp\\n8mP/az10NcvW16DmswzgcVZdUpuTp0uxUEKukMKJBEr0coz2VWWqJvrvySzQNJij\\nlIUCo5pe8pu8pz4QNm5qokuh4PLb5Mv8Sr0FQNXm5YyFfTr4H0Rs3jyy8vpmyZae\\nPv8wvLSxeUkFz49lKYDxirpR69SG5MUyTE1mpat59g8kyT7XqRWzY0BkGrnUSNAq\\naJ64FtukBCcFjFLXXlg+cpEUNEhMUc0dEefk3zBSyTSxCN0mF2zYDFBhwwvx2QIt\\nEKP7qGuvAgMBAAECggEAQAoHCakc2UW9/kgB+AuZk6fFo6C4qbNllJPHTTXsvPS2\\nqF7hp2IWKKNStPK7Nxig0HyBad20u9U2JhswbmNxJzeN73ymzcfu2eTEqYoHfBTz\\n7vTP0tg93EbZtQkFp0xNi9tkNByInnn7jQpRKic9c0yjxaIWVtjOh/L8XFhNscvw\\n9MbZmHIihg8RsqUIAPDcnlNBut5Fn9oy/g2VxWcO4r3k2vZI1AFqD4ulepZNfK0V\\n8Oh/1jXjbLTnfdiLd+z1nWkLw1nTEn1efo/oATnEj1h29gbLw+eyLgGaUF/9cYlm\\nxu1iCKsGp6Z4W8Zj1OgG7LAj/ZALZVV7M0GJBk37gQKBgQDwYI77wgBvjW74t5vI\\nvL4fM4a8iW3XVEhcIbKbWIA39013WcqRasO2lz1uzPF24auVVEPpMoZ8ckiC5O4j\\ntA2GEMaBP9zWxCNrMWhs58+4WX4ewIo1KuEcrXpCjbRV0bO7wZRqRkx4kKbUnPLz\\nOQJPlG9sXDz3Bt63YCnTjB3BwwKBgQDl7FQctzFLsYO/0V+5yonXsn7mlj20Duzb\\nxhMv+SWs2S+450pDKauOtk1whT6GsU4DA8S/Pij1r37tjnJEAjTFpgBJaG9RGMdo\\n0Z75wKmrSHSsAMVpLIyIm3SCisnudKCyicoRPXq0++dhGjZd33EIw6AK0g9XAbjB\\n8PlnnWHDpQKBgQC0G5Vm++C5tN6OS3zVdt55oHD3OX3s1sD1D2a1USWZSZposAXA\\n2Z9VY5LrP3I5YjPfSukrhOkRu8urD/+DDvkHF/C0jXZaEVJ8keOtni+c8Kk4P4oO\\n9lb/1tgBoA2cM+kY6J3c11mbCL+IFSVQqsmZeR3XsnEXorUj71DHqnftYwKBgAna\\n1EwaygEdjbEWD01OUhQtsWS+wcxK63oMBlyDCEtdT79UIom4aoMGa1FMVL6/MMHO\\nUouD5YuKRx11go5JretezxpWYJcQQdPLUE4SJPOTenS4370/TJK6XwcNXdRbqVud\\nrkyI3w6M0YEG95eUcSrX/68XC9NF3p5pbrczNrKFAoGBAOxmADnbuwznEzD+cnvQ\\nAAJnWT2fJq7pGnV3ehfblE+TWo92XWT9lgrMmc3+9X458JMstCHC96Qzv2b6OuAB\\n8TidMcTD0w4eZkEUa3yeE79gbHRRjbKkKvsKrP5wOmOoTMsiZcR6Eyp9EiHOhzAz\\nhslchmlX38bn7mmY1+s6E9EM\\n-----END PRIVATE KEY-----\\n\""
                let pHeader = {"alg": "RS256", "typ": "JWT"};
                let sHeader = JSON.stringify(pHeader);

                let pClaim = {};
                pClaim.aud = "https://www.googleapis.com/oauth2/v4/token";
                pClaim.scope = "https://www.googleapis.com/auth/calendar";
                pClaim.iss = "coronet-booking-account@booking-system-217611.iam.gserviceaccount.com";
                pClaim.exp = KJUR.jws.IntDate.get("now + 1hour");
                pClaim.iat = KJUR.jws.IntDate.get("now");

                let sClaim = JSON.stringify(pClaim);

                let sJWS = KJUR.jws.JWS.sign(null, sHeader, sClaim, privKey);

                let XHR = new XMLHttpRequest();
                let urlEncodedData = "";
                let urlEncodedDataPairs = "";

                urlEncodedDataPairs.push(encodeURIComponent("grant_type") + "=" + encodeURIComponent("urn:ietf:params:oauth:grant-type:jwt-bearer"));
                urlEncodedDataPairs.push(encodeURIComponent("assertion") + "=" + encodeURIComponent(sJWS));
                urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');

                let token = "";

                XHR.addEventListener("load", function (event) {
                    let response = JSON.parse(XHR.responseText);
                    token = response["access_token"];
                    document.getElementById("code").innerHTML =
                        XHR.responseText;
                });

                XHR.addEventListener("error", function (event) {
                    console.error("Error with token request!");
                });

                XHR.open("POST", "https://www.googleapis.com/oauth2/v4/token", false);
                XHR.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                XHR.send(urlEncodedData);
            }

            let token = "ya29.c.ElkkBullet69d7-K1I8aQMO_4sUnQ0WGkq1fUtt6r3REAFrTsDsHOD0PPazHwhVPyDOZ3Gqf0reF8pmTEUuwi-upjBD2oLs1QcwXzxfk2iNnjlcZspQA87rspg";
            function get_settings() {
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4) {
                        document.getElementById("code").innerHTML =
                            this.responseText;
                    }
                };
                xhttp.open("GET", "https://www.googleapis.com/calendar/v3/users/me/settings", true);
                xhttp.setRequestHeader('Authorization', 'Bearer ' + token);
                xhttp.send();
            }

            function createCalendar() {
                let data = {
                    "summary": "testcalendar"
                };
                console.log(JSON.stringify(data));

                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4) {
                        document.getElementById("code").innerHTML =
                            this.responseText;
                    }
                };
                xhttp.open("POST", "https://www.googleapis.com/calendar/v3/calendars", true);
                xhttp.setRequestHeader('Authorization', 'Bearer ' + token);
                xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xhttp.send(JSON.stringify(data));
            }

            function get_calendars() {
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4) {
                        document.getElementById("code").innerHTML =
                            this.responseText;
                    }
                };
                xhttp.open("GET", "https://www.googleapis.com/calendar/v3/users/me/calendarList", true);
                xhttp.setRequestHeader('Authorization', 'Bearer ' + token);
                xhttp.send();
            }

            function get_events() {
                let calendarId = "vcv4mjm7fq9ammjud13evhgem4@group.calendar.google.com";
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4) {
                        document.getElementById("code").innerHTML = this.responseText;
                    }
                };
                xhttp.open("GET", "https://www.googleapis.com/calendar/v3/calendars/" + calendarId + "/events", true);
                xhttp.setRequestHeader('Authorization', 'Bearer ' + token);
                xhttp.send();
            }

            function delete_calendar() {
                let calendarId = "oo3tas3ri7msptlsbqhqt8r7t4@group.calendar.google.com";
                let xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4) {
                        document.getElementById("code").innerHTML = this.responseText;
                    }
                };
                xhttp.open("DELETE",  "https://www.googleapis.com/calendar/v3/calendars/" + calendarId, true);
                xhttp.setRequestHeader('Authorization', 'Bearer ' + token);
                xhttp.send();
            }

            function get_calendar(calendarId) {

            }

        </script>
    </body>
</html>